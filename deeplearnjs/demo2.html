<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>线性回归</title>
</head>
<body>
    <script src="../node_modules/deeplearn/dist/deeplearn.js"></script>
    <script>
        window.onload = function(){

            dl.tidy(() => {
                //构造数据
                const p = [3,2];
                const resource = [];
                for (let i=0; i<100; i++) {
                    let tmpX0 = Math.random() * 10;
                    let tmpX1 = Math.random() * 10;
                    let offset = Math.random() * 10;
                    let tmpY = tmpX0 * p[0] + tmpX1 * p[1] + offset
                    resource.push({
                        x: [tmpX0,tmpX1],
                        y: tmpY
                    })
                }

                let xArr = [];
                let yArr = [];
                for(let i=0;i<resource.length;i++){
                    xArr.push(resource[i].x);
                    yArr.push(resource[i].y);
                }
                let xData = dl.tensor2d(xArr);
                let yData = dl.tensor2d(yArr);

                //初始化模型参数
                const matrix = dl.tensor2d([1,1],[2,1]);//用于把100x2转换为100x1的形式方便和Y值相减
                const weights = dl.variable(dl.randomNormal([2]));
                const biases = dl.variable(dl.zeros([1]));

                //学习速度和优化器
                const LEARNING_RATE = .05;
                const optimizer = dl.train.sgd(LEARNING_RATE)

                //模型函数
                function inference(input) {
                    return weights.mul(input).add(biases);
                }

                //损失函数
                function loss(predictions, labels) {
                    let cost = predictions.matMul(matrix).sub(labels).square().mean();
                    return cost;
                }

                //训练
                function train() {
                    for (let i = 0; i < 100; i++) {
                        optimizer.minimize(() => loss(inference(xData), yData))
                        console.log('-----');
                        console.log(weights.dataSync());
                        console.log(biases.dataSync());
                    }
                }
                train();
            });

        }
    </script>
</body>
</html>